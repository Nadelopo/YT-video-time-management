// ==UserScript==
// @name        yt-video-time-management
// @version     1.1.0
// @description extension for video time management
// @match       https://www.youtube.com/watch?*
// @icon        https://www.google.com/s2/favicons?sz=64&domain=youtube.com
// @downloadURL https://github.com/Nadelopo/YT-video-time-management/raw/main/dist/yt-video-time-management.user.js
// @updateURL   https://github.com/Nadelopo/YT-video-time-management/raw/main/dist/yt-video-time-management.user.js
// @grant       GM_addStyle
// ==/UserScript==

var me=Object.defineProperty,pe=(v,f,g)=>f in v?me(v,f,{enumerable:!0,configurable:!0,writable:!0,value:g}):v[f]=g,L=(v,f,g)=>(pe(v,typeof f!="symbol"?f+"":f,g),g);(function(){"use strict";function v(t,e){var n=f(t),r=n.tag,o=n.id,i=n.className,a=e?document.createElementNS(e,r):document.createElement(r);return o&&(a.id=o),i&&(e?a.setAttribute("class",i):a.className=i),a}function f(t){for(var e=t.split(/([.#])/),n="",r="",o=1;o<e.length;o+=2)switch(e[o]){case".":n+=" "+e[o+1];break;case"#":r=e[o+1]}return{className:n.trim(),tag:e[0]||"div",id:r}}function g(t,e){var n=d(t),r=d(e);return e===r&&r.__redom_view&&(e=r.__redom_view),r.parentNode&&(A(e,r,n),n.removeChild(r)),e}function A(t,e,n){var r=e.__redom_lifecycle;if(C(r)){e.__redom_lifecycle={};return}var o=n;for(e.__redom_mounted&&w(e,"onunmount");o;){var i=o.__redom_lifecycle||{};for(var a in r)i[a]&&(i[a]-=r[a]);C(i)&&(o.__redom_lifecycle=null),o=o.parentNode}}function C(t){if(t==null)return!0;for(var e in t)if(t[e])return!1;return!0}var X=["onmount","onremount","onunmount"],$=typeof window<"u"&&"ShadowRoot"in window;function M(t,e,n,r){var o=d(t),i=d(e);e===i&&i.__redom_view&&(e=i.__redom_view),e!==i&&(i.__redom_view=e);var a=i.__redom_mounted,u=i.parentNode;if(a&&u!==o&&A(e,i,u),n!=null)if(r){var s=d(n);s.__redom_mounted&&w(s,"onunmount"),o.replaceChild(i,s)}else o.insertBefore(i,d(n));else o.appendChild(i);return J(e,i,o,u),e}function w(t,e){e==="onmount"||e==="onremount"?t.__redom_mounted=!0:e==="onunmount"&&(t.__redom_mounted=!1);var n=t.__redom_lifecycle;if(n){var r=t.__redom_view,o=0;r&&r[e]&&r[e]();for(var i in n)i&&o++;if(o)for(var a=t.firstChild;a;){var u=a.nextSibling;w(a,e),a=u}}}function J(t,e,n,r){for(var o=e.__redom_lifecycle||(e.__redom_lifecycle={}),i=n===r,a=!1,u=0,s=X;u<s.length;u+=1){var c=s[u];i||t!==e&&c in t&&(o[c]=(o[c]||0)+1),o[c]&&(a=!0)}if(!a){e.__redom_lifecycle={};return}var l=n,S=!1;for((i||l&&l.__redom_mounted)&&(w(e,i?"onremount":"onmount"),S=!0);l;){var E=l.parentNode,K=l.__redom_lifecycle||(l.__redom_lifecycle={});for(var D in o)K[D]=(K[D]||0)+o[D];if(S)break;(l.nodeType===Node.DOCUMENT_NODE||$&&l instanceof ShadowRoot||E&&E.__redom_mounted)&&(w(l,i?"onremount":"onmount"),S=!0),l=E}}function ee(t,e,n){var r=d(t);if(typeof e=="object")for(var o in e)T(r,o,e[o]);else T(r,e,n)}function T(t,e,n){t.style[e]=n??""}var O="http://www.w3.org/1999/xlink";function z(t,e,n,r){var o=d(t),i=typeof e=="object";if(i)for(var a in e)z(o,a,e[a],r);else{var u=o instanceof SVGElement,s=typeof n=="function";if(e==="style"&&typeof n=="object")ee(o,n);else if(u&&s)o[e]=n;else if(e==="dataset")Q(o,n);else if(!u&&(e in o||s)&&e!=="list")o[e]=n;else{if(u&&e==="xlink"){Y(o,n);return}r&&e==="class"&&(n=o.className+" "+n),n==null?o.removeAttribute(e):o.setAttribute(e,n)}}}function Y(t,e,n){if(typeof e=="object")for(var r in e)Y(t,r,e[r]);else n!=null?t.setAttributeNS(O,e,n):t.removeAttributeNS(O,e,n)}function Q(t,e,n){if(typeof e=="object")for(var r in e)Q(t,r,e[r]);else n!=null?t.dataset[e]=n:delete t.dataset[e]}function te(t){return document.createTextNode(t??"")}function G(t,e,n){for(var r=0,o=e;r<o.length;r+=1){var i=o[r];if(!(i!==0&&!i)){var a=typeof i;a==="function"?i(t):a==="string"||a==="number"?t.appendChild(te(i)):P(d(i))?M(t,i):i.length?G(t,i,n):a==="object"&&z(t,i,null,n)}}}function d(t){return t.nodeType&&t||!t.el&&t||d(t.el)}function P(t){return t&&t.nodeType}function x(t){for(var e=[],n=arguments.length-1;n-- >0;)e[n]=arguments[n+1];var r,o=typeof t;if(o==="string")r=v(t);else if(o==="function"){var i=t;r=new(Function.prototype.bind.apply(i,[null].concat(e)))}else throw new Error("At least one argument required");return G(d(r),e,!0),r}var m=x;x.extend=function(){for(var t=[],e=arguments.length;e--;)t[e]=arguments[e];return x.bind.apply(x,[this].concat(t))};function k(t){for(var e=[],n=arguments.length-1;n-- >0;)e[n]=arguments[n+1];for(var r=d(t),o=W(t,e,r.firstChild);o;){var i=o.nextSibling;g(t,o),o=i}}function W(t,e,n){for(var r=n,o=Array(e.length),i=0;i<e.length;i++)o[i]=e[i]&&d(e[i]);for(var a=0;a<e.length;a++){var u=e[a];if(u){var s=o[a];if(s===r){r=r.nextSibling;continue}if(P(s)){var c=r&&r.nextSibling,l=u.__redom_index!=null,S=l&&c===o[a+1];M(t,u,r,S),S&&(r=c);continue}u.length!=null&&(r=W(t,u,r))}}return r}class p{constructor(e){L(this,"el"),this.el=m("input",{className:e??"",type:"number",value:"00",min:0,max:60,maxlength:2})}}class b{constructor(e,n,r){L(this,"el"),this.el=m("div",{className:"content__time"}),k(this.el,[m("div",e+":"),m("div","min."),n,m("div","sec."),r])}}class j{constructor(e,n){L(this,"el"),this.el=m("div",{className:"content__wrapper__time"}),k(this.el,[e,n])}}function V(t){return new Promise(e=>{if(document.querySelector(t))return e(document.querySelector(t));const n=new MutationObserver(r=>{document.querySelector(t)&&(e(document.querySelector(t)),n.disconnect())});n.observe(document.body,{childList:!0,subtree:!0})})}const ne=(t,e)=>{const n=new DOMParser().parseFromString(atob(t.replace(/data:image\/svg\+xml;base64,/,"")),"image/svg+xml").querySelector("svg");return e&&n.classList.add(e),n},re="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyMCIgaGVpZ2h0PSIyMCIgZmlsbD0iY3VycmVudENvbG9yIiBjbGFzcz0iYmkgYmktZ2Vhci1maWxsIiB2aWV3Qm94PSIwIDAgMTYgMTYiPg0KICA8cGF0aCBkPSJNOS40MDUgMS4wNWMtLjQxMy0xLjQtMi4zOTctMS40LTIuODEgMGwtLjEuMzRhMS40NjQgMS40NjQgMCAwIDEtMi4xMDUuODcybC0uMzEtLjE3Yy0xLjI4My0uNjk4LTIuNjg2LjcwNS0xLjk4NyAxLjk4N2wuMTY5LjMxMWMuNDQ2LjgyLjAyMyAxLjg0MS0uODcyIDIuMTA1bC0uMzQuMWMtMS40LjQxMy0xLjQgMi4zOTcgMCAyLjgxbC4zNC4xYTEuNDY0IDEuNDY0IDAgMCAxIC44NzIgMi4xMDVsLS4xNy4zMWMtLjY5OCAxLjI4My43MDUgMi42ODYgMS45ODcgMS45ODdsLjMxMS0uMTY5YTEuNDY0IDEuNDY0IDAgMCAxIDIuMTA1Ljg3MmwuMS4zNGMuNDEzIDEuNCAyLjM5NyAxLjQgMi44MSAwbC4xLS4zNGExLjQ2NCAxLjQ2NCAwIDAgMSAyLjEwNS0uODcybC4zMS4xN2MxLjI4My42OTggMi42ODYtLjcwNSAxLjk4Ny0xLjk4N2wtLjE2OS0uMzExYTEuNDY0IDEuNDY0IDAgMCAxIC44NzItMi4xMDVsLjM0LS4xYzEuNC0uNDEzIDEuNC0yLjM5NyAwLTIuODFsLS4zNC0uMWExLjQ2NCAxLjQ2NCAwIDAgMS0uODcyLTIuMTA1bC4xNy0uMzFjLjY5OC0xLjI4My0uNzA1LTIuNjg2LTEuOTg3LTEuOTg3bC0uMzExLjE2OWExLjQ2NCAxLjQ2NCAwIDAgMS0yLjEwNS0uODcybC0uMS0uMzR6TTggMTAuOTNhMi45MjkgMi45MjkgMCAxIDEgMC01Ljg2IDIuOTI5IDIuOTI5IDAgMCAxIDAgNS44NTh6Ii8+DQo8L3N2Zz4=",oe=`#owner .menu__root{position:relative;margin-left:10px}#owner .menu__root .settings{cursor:pointer;transition:.3s;user-select:none}#owner .menu__root .settings:hover{transform:rotate(180deg) scale(1.1)}#owner .menu__root .content{position:absolute;top:0;left:30px;background:#1c1c1c;border-radius:8px;width:240px;height:290px;z-index:100;animation:menuOpen .2s;padding:12px;box-sizing:border-box;font-size:14px;overflow:auto}#owner .menu__root .content.close{animation:menuClose .1s}#owner .menu__root .content::-webkit-scrollbar{width:8px}#owner .menu__root .content::-webkit-scrollbar-track{background-color:#1c1c1c;border-radius:0 0 8px}#owner .menu__root .content::-webkit-scrollbar-thumb{background:#7b7b7b;border-radius:10px;transform:scaleY(-1)}#owner .menu__root .content .content__wrapper__time{margin-bottom:6px}#owner .menu__root .content .content__wrapper__time .content__time{display:grid;grid-template-columns:60px auto 1fr auto 1fr;align-items:center;gap:4px}#owner .menu__root .content .content__wrapper__time .content__time .loop{display:flex;gap:4px;align-items:center}#owner .menu__root .content input{margin:4px 0;border:none;border-radius:4px;background:#363636;color:#fff;outline:none;width:24px;text-align:center}#owner .menu__root .content input::-webkit-inner-spin-button{-webkit-appearance:none;margin:0}#owner .menu__root .content hr{all:revert}@keyframes menuOpen{0%{opacity:.6;transform:scale(0)}to{opacity:1;transform:scale(1)}}@keyframes menuClose{0%{opacity:1;transform:scale(1)}to{opacity:.6;transform:scale(0)}}.mb-6{margin-bottom:6px}.mt-8{margin-top:6px}.btn{font-family:Roboto;font-size:16px;cursor:pointer;border-radius:10px;outline:none;color:#1c1c1c;background:#363636;padding:2px 6px 1px;transition:.4s;border:2px solid #363636;width:100%;color:#fff}.btn:hover{background:#1c1c1c}
`;GM_addStyle(oe);const N=m("div",{className:"menu__root"}),R=new p().el,q=new p().el,F=new p().el,Z=new p().el,y=m("div",{className:"content"}),ie=new b("start",R,q),ae=new b("end",F,Z),_=[{inputSkipStartMin:new p().el,inputSkipStartSec:new p().el,inputSkipEndMin:new p().el,inputSkipEndSec:new p().el}],ue=new b("start",_[0].inputSkipStartMin,_[0].inputSkipStartSec),ce=new b("end",_[0].inputSkipEndMin,_[0].inputSkipEndSec),h=m("div",{className:"content__skip"});M(h,new j(ue,ce));const le=m("button","add time skip",{className:"btn mt-8",onclick:()=>{_.push({inputSkipStartMin:new p().el,inputSkipStartSec:new p().el,inputSkipEndMin:new p().el,inputSkipEndSec:new p().el});const t=new b("start",_.at(-1).inputSkipStartMin,_.at(-1).inputSkipStartSec),e=new b("end",_.at(-1).inputSkipEndMin,_.at(-1).inputSkipEndSec);M(h,new j(t,e))}}),B=m("button","apply",{className:"btn mt-8"}),H=m("button","cancel",{className:"btn mt-8"});k(y,[m("div","loop time video",{className:"mb-6"}),new j(ie,ae),m("hr"),m("div","skip time video",{className:"mb-6"}),h,le,B,H]);const se=()=>{y.classList.add("close"),setTimeout(()=>{g(N,y),y.classList.remove("close")},100)};let I=!0;const U=ne(re,"settings");U.onclick=()=>{I?M(N,y):se(),I=!I},M(N,U),(async()=>{let t=0,e=0;const n=[];let r=0,o=0,i=!1,a=await V("#ytd-player");const u=await V(".item.style-scope.ytd-watch-metadata");M(u,N);function s(c){c===1&&(o=setInterval(()=>{(e&&r>=e||r<t)&&(clearInterval(o),a.player_.seekTo(t)),n.forEach(l=>{l.timeSkipEnd&&r>=l.timeSkipStart&&r<l.timeSkipEnd&&(clearInterval(o),a.player_.seekTo(l.timeSkipEnd))}),r=a.player_.getCurrentTime()},1e3)),(c==2||c==3||c==0)&&clearInterval(o)}B.onclick=()=>{t=Number(R.value)*60+Number(q.value),e=Number(F.value)*60+Number(Z.value),_.forEach(c=>{n.push({timeSkipStart:Number(c.inputSkipStartMin.value)*60+Number(c.inputSkipStartSec.value),timeSkipEnd:Number(c.inputSkipEndMin.value)*60+Number(c.inputSkipEndSec.value)})}),i||(s(1),setTimeout(()=>{a.player_.addEventListener("onStateChange",s)},1e3),i=!0)},H.onclick=()=>{clearInterval(o),a.player_.removeEventListener("onStateChange",s),i=!1}})()})();
